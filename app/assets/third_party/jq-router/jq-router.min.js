!function(e,r){var t,n,a,u={routeChangeStart:"jqRouter.routeChangeStart",routeChangeSuccess:"jqRouter.routeChangeSuccess",renderViewSuccess:"jqRouter.renderViewSuccess",viewDestroyed:"jqRouter.viewDestroyed"},o={route:{},params:{}};t=function(){var t,s={},i=!0,c={Param_Replacer:"([^/]+)",Param_Matcher:/:([\w\d]+)/g};return s.getCurrentParams=function(){return o.params},s.getCurrentRoute=function(){return o.route},s.getRouteName=function(e){return this.routes[e]},s.getRouteParams=function(r){for(var t={},a=r.urlExpr.exec(r.url),u=0;u<r.params.length;u++)t[r.params[u]]=a[u+1];return e.extend({},n.getParams(),t)},s.go=function(e,t){var a=this;return n.setParams(t),r.location=a.href(e,t),a},s.href=function(e,r){e=e||t;for(var n=this.routes[e],a=n.relativeUrl,u=0;u<n.params.length;u++)a=a.replace(":"+n.params[u],r[n.params[u]]);return a},s.isRouteParamChanged=function(e,r){var t=this;return t.href(e,r)!==t.href(e,t.getCurrentParams())},s.match=function(e){var r,t=this;for(var n in t.routes)t.routes[n].abstract||null===t.routes[n].urlExpr.exec(e)||(r=t.routes[n]);return r},s.onhashchange=function(n){var s,i=this,c=i.match(n);return c?(c.previousUrl=o.route.url||n,c.url=n,s=i.getRouteParams(c),e(r).trigger(u.routeChangeStart,[c,s]),a.processRoute(c).then(function(){a.render(c,s),o.route=c,o.params=s,e(r).trigger(u.routeChangeSuccess,[c,s])})):i.go(t),i},s.onRouteBeforeChange=function(t){var n=this;return e(r).on(u.routeChangeStart,t),n},s.onRouteChanged=function(t){var n=this;return e(r).on(u.routeChangeSuccess,t),n},s.onViewChange=function(t){var n=this;return e(r).on(u.renderViewSuccess,t),n},s.onViewDestroyed=function(t){var n=this;return e(r).on(u.viewDestroyed,t),n},s.run=function(t,n,u){var o=this;if(i){if(-1===r.location.pathname.lastIndexOf(".")&&"/"!==r.location.pathname.substr(-1))return void(r.location.pathname=r.location.pathname+"/");a.setViewSelector(t),e(r).on("hashchange",function(){o.onhashchange(r.location.hash)}),o.match(r.location.hash)?o.onhashchange(r.location.hash):o.go(n,u),i=!1}return o},s.setData=function(e){var r=this;r.routes={};for(var t in e){var n,a=t.split("."),u=[],o="",s="",i=r.routes[t]=jQuery.extend(!0,{},e[t]);i.name=t,i.segments=[],i.params=[];for(var h=0;h<a.length;h++){u.push(a[h]);var g=u.join(".");o+=e[g].url,i.segments.push(g)}for(;null!==(n=c.Param_Matcher.exec(o));)i.params.push(n[1]);s=new RegExp(o.replace(c.Param_Matcher,c.Param_Replacer)+"$"),i.relativeUrl=o,i.urlExpr=s}return r},s.setDefault=function(e){return t=e,this},s}(),a=function(){var n,a={},o={};return a.clean=function(n,a){for(var o=n.length-1;o>=a;o--){var s=t.getRouteName(n[o]);e(r).trigger(u.viewDestroyed,[s])}},a.getViewTemplate=function(r){return e.get({url:r,dataType:"html"}).then(function(e){o[r]=e})},a.processRoute=function(r){for(var n=this,a=[],u=0;u<r.segments.length;u++){var s=t.getRouteName(r.segments[u]);o[s.templateUrl]||a.push(n.getViewTemplate(s.templateUrl))}return e.when.apply(e,a)},a.render=function(s,i){for(var c=t.getCurrentRoute(),h=e.isEmptyObject(c),g=0;g<s.segments.length;g++){var m=t.getRouteName(s.segments[g]),l=e(n+":eq("+g+")");h||(h=s.segments[g]!==c.segments[g]||t.isRouteParamChanged(s.segments[g],i))&&a.clean(c.segments,g),h&&(l.html(o[m.templateUrl]),e(r).trigger(u.renderViewSuccess,[m,s,i]))}return this},a.setViewSelector=function(e){return n=e,this},a}(),n=function(){var e,r={};return r.setParams=function(r){e=r},r.getParams=function(){return e},r}(),e.router=t}(jQuery,this);